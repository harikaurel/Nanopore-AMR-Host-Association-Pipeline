#!/usr/bin/env bash
set -euo pipefail

# ============================================================
# Dorado demultiplexing
# ============================================================

# ------------------------------------------------------------
# Tool path (edit as needed)
# ------------------------------------------------------------
DORADO_BIN="/path/to/dorado/bin/dorado"

# ------------------------------------------------------------
# Input / output
# ------------------------------------------------------------
INPUT_BAM="/path/to/basecalled/trimmed.bam"
OUTPUT_DIR="/path/to/demux"

# ------------------------------------------------------------
# Demux parameters
# ------------------------------------------------------------
NO_CLASSIFY=1   # 1 = --no-classify, 0 = off

# ------------------------------------------------------------
# Prepare output directory
# ------------------------------------------------------------
mkdir -p "$OUTPUT_DIR"

# ------------------------------------------------------------
# Build command
# ------------------------------------------------------------
CMD=(
  "$DORADO_BIN" demux
  --output-dir "$OUTPUT_DIR"
)

[[ "$NO_CLASSIFY" == "1" ]] && CMD+=(--no-classify)

CMD+=("$INPUT_BAM")

# ------------------------------------------------------------
# Run
# ------------------------------------------------------------
"${CMD[@]}"
