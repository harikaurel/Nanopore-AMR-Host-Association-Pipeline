#!/usr/bin/env bash
set -euo pipefail

# ============================================================
# Dorado polishing
# ============================================================

# ------------------------------------------------------------
# Tool path (edit as needed)
# ------------------------------------------------------------
DORADO_BIN="/path/to/dorado/bin/dorado"

# ------------------------------------------------------------
# Input / output
# ------------------------------------------------------------
ALN_BAM="/path/to/aligned.sorted.bam"
REF_FASTA="/path/to/reference.fasta"
OUT_FASTA="/path/to/polished.fasta"

# ------------------------------------------------------------
# Polishing parameters
# ------------------------------------------------------------
IGNORE_READ_GROUPS=1   # 1 = --ignore-read-groups
BACTERIA_MODE=1        # 1 = --bacteria

# ------------------------------------------------------------
# Prepare output directory
# ------------------------------------------------------------
mkdir -p "$(dirname "$OUT_FASTA")"

# ------------------------------------------------------------
# Build command
# ------------------------------------------------------------
CMD=(
  "$DORADO_BIN" polish
  "$ALN_BAM"
  "$REF_FASTA"
)

[[ "$IGNORE_READ_GROUPS" == "1" ]] && CMD+=(--ignore-read-groups)
[[ "$BACTERIA_MODE" == "1" ]] && CMD+=(--bacteria)

# ------------------------------------------------------------
# Run
# ------------------------------------------------------------
"${CMD[@]}" > "$OUT_FASTA"
