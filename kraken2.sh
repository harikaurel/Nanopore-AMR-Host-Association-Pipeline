#!/usr/bin/env bash
set -euo pipefail

# ============================================================
# Kraken2 taxonomic classification (contigs)
# ============================================================

# ------------------------------------------------------------
# Tool path (edit as needed)
# ------------------------------------------------------------
KRAKEN2_BIN="/path/to/kraken2"

# ------------------------------------------------------------
# Database
# ------------------------------------------------------------
KRAKEN2_DB="/path/to/kraken2_db"

# ------------------------------------------------------------
# Input / output
# ------------------------------------------------------------
INPUT_FASTA="/path/to/assembly.fasta"
OUT_DIR="/path/to/kraken2_output"

OUTPUT_FILE="${OUT_DIR}/kraken2.out"
REPORT_FILE="${OUT_DIR}/kraken2.report"

# ------------------------------------------------------------
# Parameters
# ------------------------------------------------------------
THREADS=12
USE_NAMES=1   # 1 = --use-names, 0 = off

# ------------------------------------------------------------
# Prepare output directory
# ------------------------------------------------------------
mkdir -p "$OUT_DIR"

# ------------------------------------------------------------
# Build command
# ------------------------------------------------------------
CMD=(
  "$KRAKEN2_BIN"
  --db "$KRAKEN2_DB"
  --threads "$THREADS"
  --report "$REPORT_FILE"
  --output "$OUTPUT_FILE"
)

[[ "$USE_NAMES" == "1" ]] && CMD+=(--use-names)

CMD+=("$INPUT_FASTA")

# ------------------------------------------------------------
# Run
# ------------------------------------------------------------
"${CMD[@]}"
